/* 
 * ðŸ“œ Verified Authorship â€” Manuel J. Nieves (B4EC 7343 AB0D BF24)
 * Original protocol logic. Derivative status asserted.
 * Commercial use requires license.
 * Contact: Fordamboy1@gmail.com
 */
function ETHEREUM_WALLET_copyAddress(a){a.preventDefault();var b=jQuery("<input>");jQuery("body").append(b);var c=jQuery(a.target).data("input-id");console.log("Copy from: ",c);var d=jQuery("#"+c).val();console.log("Value to copy: ",d),b.val(d).select(),document.execCommand("copy"),b.remove(),alert(window.ethereumWallet.str_copied_msg)}function ETHEREUM_WALLET_init(){if(void 0!==window.ethereumWallet&&!0!==window.ethereumWallet.initialized){if(void 0!==window.ethereumWallet.web3Endpoint){if("undefined"!=typeof window&&void 0!==window.web3){var a=window.web3.currentProvider;window.ethereumWallet.web3metamask=new Web3(a)}window.ethereumWallet.web3=new Web3(new Web3.providers.HttpProvider(window.ethereumWallet.web3Endpoint))}ETHEREUM_WALLET_update_transactions();var b=window.ethereumWallet.user_wallet_last_txhash;if(""!==b){var c=1,d=300,e=window.ethereumWallet.user_wallet_last_txtime,f=1e3*d;""!==e&&(f=1e3*parseInt(e));var g=new Date;g-new Date(g.getTime()-f)<1e3*d&&(ETHEREUM_WALLET_show_wait_icon(),ETHEREUM_WALLET_awaitBlockConsensus(b,c,d,f,function(a,b){if(a)return ETHEREUM_WALLET_hide_wait_icon(),void console.log(a);setTimeout(function(){ETHEREUM_WALLET_hide_wait_icon(),ETHEREUM_WALLET_update_transactions()},15e3)}))}window.ethereumWallet.initialized=!0}}function ETHEREUM_WALLET_update_transactions(){0!==jQuery(".ethereum-wallet-history-table").length&&ETHEREUM_WALLET_load_transactions(window.ethereumWallet.user_wallet_address,function(a,b){a&&(console.log(a),b=[]),ETHEREUM_WALLET_load_internal_transactions(window.ethereumWallet.user_wallet_address,function(a,c){a&&(console.log(a),c=[]);var d=ETHEREUM_WALLET_prepare_transactions(b,window.ethereumWallet.user_wallet_address),e=ETHEREUM_WALLET_prepare_transactions(c,window.ethereumWallet.user_wallet_address);d=d.concat(e);var f={};d.forEach(function(a){f[a.hash]=a}),d=Object.keys(f).map(function(a){return f[a]}),d.sort(function(a,b){return b.timeStamp-a.timeStamp}),ETHEREUM_WALLET_render_transactions(d)})})}function ETHEREUM_WALLET_render_transactions(a){jQuery(".ethereum-wallet-history-table tbody").html("");var b="";"mainnet"!==window.ethereumWallet.blockchain_network&&(b=window.ethereumWallet.blockchain_network+".");for(var c=0;c<a.length;c++){var d=a[c],e=(new Date-new Date(1e3*d.timeStamp))/864e5,f="";if(e>=1)f=Math.floor(e)+" days";else{var g=24*e;if(g>=1)f=Math.floor(g)+" hours";else{var h=60*g;f=h>=1?Math.floor(h)+" minutes":"recently"}}var i=d.hash.substr(0,8),j=d.value;jQuery(".ethereum-wallet-history-table").each(function(){if($tbl=jQuery(this),$tbody=$tbl.find("tbody"),0!==$tbody.length){var a=$tbody.children().length;if(!(a>=10)){var c="<tr>";c+='<th scope="row">'+(a+1)+"</th>",d.dir?c+="<td>"+j+"</td>":c+='<td><span class="ethereum-wallet-history-dir ethereum-wallet-history-minus">-</span>'+j+"</td>",c+="<td>"+f+"</td>",c+='<td><a target="_blank" href="https://'+b+"etherscan.io/tx/"+d.hash+'">'+i+"</td>",c+="</tr>";var e=$tbl.hasClass("ethereum-wallet-history-table-direction-in"),g=$tbl.hasClass("ethereum-wallet-history-table-direction-out");d.dir&&g||!d.dir&&e||($tbody=$tbl.find("tbody"),$tbody.length>0&&$tbody.children().length<10&&jQuery(c).appendTo($tbody))}}})}}function ETHEREUM_WALLET_prepare_transactions(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];if("0"!==e.value){var f=parseFloat(e.value)/1e18;c.push({value:f+" ETH",timeStamp:parseInt(e.timeStamp),hash:e.hash,dir:b.toLowerCase()===e.to.toLowerCase()})}}return c}function ETHEREUM_WALLET_validate_send_form(){if(0===window.ethereumWallet.web3.eth.getBalance(window.ethereumWallet.user_wallet_address).toNumber())return alert(window.ethereumWallet.str_insufficient_eth_balance_msg),!1}function ETHEREUM_WALLET_load_transactions(a,b){if(""===a)return void b.call(null,"Empty address requested for ETHEREUM_WALLET_load_transactions!",null);var c="";"mainnet"!==window.ethereumWallet.blockchain_network&&(c="-"+window.ethereumWallet.blockchain_network),jQuery.ajax({headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},url:"https://api"+c+".etherscan.io/api?module=account&action=txlist&address="+a+"&startblock=0&endblock=99999999&sort=desc",success:function(a){if("1"!==a.status)return console.log(a.message),void b.call(null,a.message,null);var c=a.result;b.call(null,null,c)}})}function ETHEREUM_WALLET_load_internal_transactions(a,b){if(""===a)return void b.call(null,"Empty address requested for ETHEREUM_WALLET_load_internal_transactions!",null);var c="";"mainnet"!==window.ethereumWallet.blockchain_network&&(c="-"+window.ethereumWallet.blockchain_network),jQuery.ajax({headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},url:"https://api"+c+".etherscan.io/api?module=account&action=txlistinternal&address="+a+"&startblock=0&endblock=99999999&sort=desc",success:function(a){if("1"!==a.status)return console.log(a.message),void b.call(null,a.message,null);var c=a.result;b.call(null,null,c)}})}function ETHEREUM_WALLET_awaitBlockConsensus(a,b,c,d,e){var f,g=window.ethereumWallet.web3,h=Number.MAX_SAFE_INTEGER,i={start:1,mined:2,awaited:3,confirmed:4,unconfirmed:5},j=new Date((new Date).getTime()-d),k=i.start,l=function(){return!(new Date-j>1e3*c&&(k=i.unconfirmed,e(new Error("Timed out, not confirmed"),null),1))},m=function(){l()&&g.eth.getTransaction(a,function(a,b){if(a||null===b)return console.log(a),void setTimeout(m,1e3);null!==b.blockHash?(h=b.blockNumber,f=b,console.log("mined"),k=i.mined,setTimeout(n,1)):setTimeout(m,1e3)})},n=function(){l()&&g.eth.getBlockNumber(function(a,c){if(a)return console.log(a),void setTimeout(n,1e3);console.log("blockNum: ",c),c>=b+h?(k=i.awaited,setTimeout(o,1)):(console.log("Need to wait ",b+h-c," blocks"),setTimeout(n,1e3))})},o=function(){l()&&g.eth.getTransactionReceipt(a,function(a,b){if(a||null===b)return a&&console.log("getTransactionReceipt: ",a),void setTimeout(o,1e3);console.log("receipt: ",b),b.gasUsed>=f.gas?(k=i.unconfirmed,e(new Error("we ran out of gas, not confirmed!"),null)):(k=i.confirmed,e(null,b))})};m()}function ETHEREUM_WALLET_show_wait_icon(){jQuery("#ethereum-wallet-tx-in-progress-spinner").addClass("is-active"),jQuery("#ethereum-wallet-tx-in-progress-alert").removeClass("hidden"),jQuery("#ethereum-wallet-tx-in-progress-alert").removeAttr("hidden")}function ETHEREUM_WALLET_hide_wait_icon(){jQuery("#ethereum-wallet-tx-in-progress-spinner").removeClass("is-active"),jQuery("#ethereum-wallet-tx-in-progress-alert").addClass("hidden"),jQuery("#ethereum-wallet-tx-in-progress-alert").attr("hidden"," hidden")}String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.indexOf(a,b)===b}}),Object.keys||(Object.keys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),jQuery(document).ready(ETHEREUM_WALLET_init),jQuery(document).ajaxComplete(function(a,b,c){!b||void 0===b.responseText||-1===b.responseText.indexOf("ethereum-wallet-account-shortcode")&&-1===b.responseText.indexOf("ethereum-wallet-sendform-shortcode")&&-1===b.responseText.indexOf("ethereum-wallet-balance-shortcode")&&-1===b.responseText.indexOf("ethereum-wallet-tokens-list-shortcode")&&-1===b.responseText.indexOf("ethereum-wallet-history-shortcode")||ETHEREUM_WALLET_init()});